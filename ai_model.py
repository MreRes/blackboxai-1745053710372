from transformers import pipeline
from logger_config import setup_logger

logger = setup_logger()

class FinancialPlannerAI:
    def __init__(self):
        logger.info("Loading AI model...")
        # Change pipeline task from "conversational" to "text-generation"
        self.nlp = pipeline("text-generation", model="microsoft/DialoGPT-medium")
        logger.info("AI model loaded.")

    def generate_response(self, input_text: str) -> str:
        logger.info(f"Generating response for input: {input_text}")
        try:
            response = self.nlp(input_text, max_length=100, num_return_sequences=1)
            # Extract generated text from response object
            if response and len(response) > 0:
                generated_text = response[0]['generated_text'] if 'generated_text' in response[0] else str(response[0])
                logger.info(f"Generated response: {generated_text}")
                return generated_text
            else:
                logger.warning("No response generated by AI model.")
                return "Maaf, saya tidak mengerti."
        except Exception as e:
            logger.error(f"Error generating response: {e}")
            return "Terjadi kesalahan saat memproses permintaan Anda."
